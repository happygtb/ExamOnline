<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>编辑题目 </title>
<script type="text/javascript" src="../js/jquery-1.11.3.js"></script>
<script type="text/javascript" src="../js/bootstrap.min.js"></script>
<script type="text/javascript" src="../js/editQuestion.js"></script>
<link href="../css/bootstrap.css" rel='stylesheet' type='text/css' />
<link href="../css/importQuestions.css" rel='stylesheet' type='text/css' />
<link href="../css/blue.css" rel="stylesheet">
<script src="../js/icheck.js"></script>
<style type="text/css">
	html, body {
		font-family: 'Lato', 微软雅黑;
		font-size: 100%;
		background: #fff;
    }
	body {
		padding-top: 70px;
	}
	.form-control{
		margin-top:0;
	}
	.close{
		margin-bottom:0;
	}
	.input-group-addon span{
		padding:0;
	}
    .user-img-div {
        min-height: 140px;
        padding: 20px;
        background-color: #4380B8;
    }

    .user-img-div img {
        max-height: 70px;
    }

    .user-img-div .inner-text {
        text-align: right;
        position: relative;
        color: #fff;
        font-weight: 800;
        line-height: 25px;
    }

    .list-group-item:first-child {
        border-radius: 0;
    }

    .list-group a {
        text-indent: 1.2em;
    }

    .glyphicon {
        padding-right: 0.5em;
    }

    #footer-sec {
        background-color: #4380B8;
        margin-top: 20px;
        padding: 20px 50px;
        color: #fff;
        font-size: 12px;
    }
    label {
	    margin-bottom: 0;
	}
	#questionTypeList{
		position: relative;
	    display: block;
	    padding: 10px 15px;
	    margin-bottom: -1px;
	    background-color: #fff;
	    border: 1px solid #ddd;
	    text-indent:1.2em;
	}
	.questionTypeList{
	    padding: 5px 0;
	    margin: 0 0 0 5em; 
	} 
</style>
</head> 
<body>
  <nav class="navbar navbar-default navbar-fixed-top">
		<div class="container-fluid">
			<!-- Brand and toggle get grouped for better mobile display -->
			<div class="navbar-header" style="margin-left: 40px;">
				<button type="button" class="navbar-toggle collapsed"
					data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"
					aria-expanded="false">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="#">首页</a>
			</div>
			<div class="collapse navbar-collapse"
				id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav">
					<li class="active"><a href="#">题库管理<span class="sr-only">(current)</span></a></li>
					<li><a href="#">试卷管理</a></li>
					<li><a href="#">考试管理</a></li>
					<li><a href="#">成绩管理</a></li>
					<li><a href="#">系统管理</a></li>
				</ul>
				<form class="navbar-form navbar-left" role="search">
					<div class="form-group">
						<input type="text" class="form-control" style="margin-top: 0"
							placeholder="输入关键词">
					</div>
					<button type="submit" class="btn btn-default">搜索</button>
				</form>
				<ul class="nav navbar-nav navbar-right">
					<li><a href="#">登录</a></li>
					<li><a href="#">注册</a></li>
					<li class="dropdown"><a href="#" class="dropdown-toggle"
						data-toggle="dropdown" role="button" aria-haspopup="true"
						aria-expanded="false">个人中心<span class="caret"></span></a>
						<ul class="dropdown-menu">
							<li><a href="#">账户设置</a></li>
							<li><a href="#">成绩管理</a></li>
							<li><a href="#">考试入口</a></li>
							<li role="separator" class="divider"></li>
							<li><a href="#">退出登录</a></li>
						</ul></li>
				</ul>
			</div>
		</div>
	</nav>

	<div class="container-fluid" style="padding-left: 0;">
		<div class="row-fluid">
			<div class="col-xs-12 col-md-3 col-lg-3" style="padding-left: 0;">
				<div class="user-img-div">
					<img src="../images/20160322162501.jpg" class="img-thumbnail">
					<div class="inner-text"
						style="float: right; margin-top: 20px; padding-right: 12px;">
						<label id="username">UserName</label><br /> <span
							class="glyphicon glyphicon-cog"></span><a href="#"
							class="inner-text" style="font-size: 1.2em">账户设置</a>
					</div>
				</div>
				<ul class="list-group">
					<li class="list-group-item">题库管理</li>
					<li id="questionTypeList" class="dropdown list-group-item active">		
						<a href="#" class="dropdown-toggleglyphicon" data-toggle="dropdown" role="button" aria-haspopup="true"
							aria-expanded="false"><span class="glyphicon glyphicon-th-list"></span>题目列表<span class="caret"></span></a>
						<ul class="dropdown-menu questionTypeList" style="margin-bottom:0">
							<li><a href="#">全部题目</a></li>
						</ul>	
					</li>
					<a href="addQuestions.html" class="list-group-item"><span
						class="glyphicon glyphicon-cloud-upload"></span>添加题目</a>
					<a href="checkQuestionType.html" class="list-group-item"><span
						class="glyphicon glyphicon-bookmark"></span>题型管理</a>
					<a href="checkSubject.html" class="list-group-item"><span
						class="glyphicon glyphicon-book"></span>科目管理</a>
					<a href="checkTips.html" class="list-group-item"><span
						class="glyphicon glyphicon-tags"></span>知识点管理</a>
					<a href="#" class="list-group-item"><span
						class="glyphicon glyphicon-trash"></span>批量删除</a>
				</ul>
			</div>
			<div class="col-xs-12 col-md-9 col-lg-9">  
                <div>
					<h2>题目修改</h2>
				</div>
				<hr />
                <form method='post' action='../UpdateQuestion' id="editForm" name="editForm">	 	
                        <P><label>科&emsp;目：&emsp;</label>
                            <select name="subject" id="subject" class="selector form-control" style="width: 8em;">   
                            </select>
                            <input type='hidden' value="" name='subjectid' id='subjectid'/>	
                        </p>
                        <p><label id="type">题&emsp;型：&emsp;</label><input type='hidden' value="" name='qtype' id='qtype'/></p>	
                        <P><label>知识点：&emsp;</label>
                            <select name="tips" id="tips" class="selector form-control" style="width: 8em;">
                            </select>
                            <input type='hidden' value="" name='tipid' id='tipid'/>
                        </P>
                        <P><label>难度星级：</label>
                            <input type="radio" name="Difficulty" id="Difficulty" value="1" />1
                            <input type="radio" name="Difficulty" id="Difficulty" value="2" />2
                            <input type="radio" name="Difficulty" id="Difficulty" value="3" />3	
                            <input type="radio" name="Difficulty" id="Difficulty" value="4" />4	
                            <input type="radio" name="Difficulty" id="Difficulty" value="5" />5				 
                        </P>
                        <P><label>题干/背景材料：</label></P>
                        <P><textarea id="details" name="details" class="form-control"></textarea></P>
                        <div id="Choice">
                            <div id="Coption">
                                <P><label>选项/答案内容：</label></P>	
                            </div>
                        </div>
                        <br />
                        <p><label id="labels">关键词：</label></P>									
                    <input type="button" value="确认修改" class="btn btn-primary" onclick="editFunction()">&emsp;<input type="button" class="btn btn-primary" value="关闭" />
                </form>
            </div>
	    </div>
	</div>
	<div id="footer-sec">Copyright © 2016.Company name All rights reserved.</div>
</body>
<script type="text/javascript"> 
    var id='';
    var url=window.location.search;
    var QuestionId="";
    if(url.indexOf("?")!=-1){   
        var str=url.substr(1)   
        strs=str.split("&");   
        for(i=0;i<strs.length;i++){   
            if([strs[i].split("=")[0]]=='QuestionId') QuestionId=unescape(strs[i].split("=")[1]);
        }
    }
</script>
<script type="text/javascript">
    $(document).ready(function() {
    	$.getJSON("../selectQuestion?QuestionId="+QuestionId, function(jsonData) {
            var questionid="";
            var details="";
            var labels="";
            $("#subjectid").val(jsonData.SubjectId);
            $("#qtype").val(jsonData.QTypeId);
            $("#tipid").val(jsonData.TipsId);
            details=jsonData.QuestionDetails;
            if(jsonData.Labels!="null"){
	            /* labels="<input type='text' value=\""+jsonData.Labels+"\" class=\"form-control\" name='labels'/>"; */
	            labels="<textarea name=\"labels\" class=\"form-control\" placeholder=\"为题目添加关键词（多个关键词用空格隔开）\">"+jsonData.Labels+"</textarea>";
            }else{
            	labels="<textarea name=\"labels\" class=\"form-control\" placeholder=\"为题目添加关键词（多个关键词用空格隔开）\"></textarea>";
            }
            $("#labels").parent().after(labels);
	        $("#details").append(details);
			$("#Difficulty[value='"+jsonData.Difficulty+"']").attr("checked","checked");
			
            $.getJSON("../SubjectJson", function(jsonData1) {
                var subject="";
                var subjectid = $("#subjectid").val();
                for (var i = 0; i<jsonData1.length; i++) { 
                    if((i+1)==subjectid){
                        subject+="<option selected='selected' value=\""+jsonData1[i].SubjectId+"\">"+jsonData1[i].SubjectName+"</option>";
                    }else{
                        subject+="<option value=\""+jsonData1[i].SubjectId+"\">"+jsonData1[i].SubjectName+"</option>";
                    }
                }
                $("#subject").append(subject);
                $.getJSON("../TipsJson?SubjectId="+subjectid, function(jsonData2) {
                    var tips="";
                    var tipid = $("#tipid").val();
                    for (var t = 0; t < jsonData2.length; t++) {
                        if(jsonData2[t].TipsId==tipid){
                            tips+="<option selected=selected value=\""+jsonData2[t].TipsId+"\" >"+jsonData2[t].TipsName+"</option>";
                        }else{
                            tips+="<option value=\""+jsonData2[t].TipsId+"\" >"+jsonData2[t].TipsName+"</option>";
                        }
                    }
                    $("#tips").append(tips);
                });
            });

            $.getJSON("../QTypeJson", function(jsonData) {
                var type="";
                var qtype = $("#qtype").val();
                for (var i = 0; i < jsonData.length; i++) {	
                    if(qtype==jsonData[i].QTypeId){				
                        type+="<label id=\""+jsonData[i].QTypeId+"\" >"+jsonData[i].TypeName+"</label>";
                        var qid=jsonData[i].QTypeId;
                        if(jsonData[qtype-1].TypeName=="单选题"){
                            $("#editForm").attr("action","../UpdateQuestion?qtid="+qid+"&questionid="+QuestionId+"&Qtype=SingleChoice");
                        	$.getJSON("../OptionJson?QuestionId="+QuestionId, function(jsonData) {
                           		var options="";h="";				 
                            	for (var j = 0; j < jsonData.length; j++) {
                                	if(jsonData[j].IsCorrect=="True"){
                                    	options+="<div id=\"items"+(j+1)+"\"><p><div class=\"input-group\"><div class=\"input-group-addon\"><input type='radio' value=\""+(j+1)+"\"  checked='checked'  name='SCoptions' id='SCoptions' onchange='myFunction()'/></div>";
                                    	options+="<input type='text' name=\"SCTipsDetail"+(j+1)+"\" value=\""+jsonData[j].OptionDetails+"\" class=\"form-control\" /><div class=\"input-group-addon\">";
                                    	options+="<label id=\""+(j+1)+"\" name=\"SCRemove\" onclick='removeOption(this.id)' class=\"close\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></label></div></div></p></div>";
                                	}else{
                                		options+="<div id=\"items"+(j+1)+"\"><p><div class=\"input-group\"><div class=\"input-group-addon\"><input type='radio' value=\""+(j+1)+"\" name='SCoptions' id='SCoptions' onchange='myFunction()'/></div>";
                                    	options+="<input type='text' name=\"SCTipsDetail"+(j+1)+"\" value=\""+jsonData[j].OptionDetails+"\" class=\"form-control\" /><div class=\"input-group-addon\">";
                                    	options+="<label id=\""+(j+1)+"\" name=\"SCRemove\" onclick='removeOption(this.id)' class=\"close\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></label></div></div></p></div>";
                                	}
                            	}			
                            	h+="<label id='addOptions' name=\""+j+"\" onclick='addOptions(this.name)' class=\"btn btn-block btn-primary\">点此添加一个选项</label>"
                            	$("#Coption").append(options);
                            	$("#Choice").append(h);
                            	$('input').iCheck({
            						checkboxClass: 'icheckbox_square-blue',
            						radioClass: 'iradio_square-blue',
            						increaseArea: '20%'
            					});
                        	});	
                        }else if(jsonData[qtype-1].TypeName=="多选题"){
                            $("#editForm").attr("action","../UpdateQuestion?qtid="+qid+"&questionid="+QuestionId+"&Qtype=MultipleChoice");
                            $.getJSON("../OptionJson?QuestionId="+QuestionId, function(jsonData) {
                                var options="";h="";				 
                                for (var j = 0; j < jsonData.length; j++) {
                                    if(jsonData[j].IsCorrect=="True"){
										options+="<div id=\"MCitems"+(j+1)+"\"><p><div class=\"input-group\"><div class=\"input-group-addon\"><input type='checkbox' value='True'  checked='checked' name=\"MCoptions"+(j+1)+"\" id=\"MCoptions"+(j+1)+"\" />";
                                        options+="</div><input type='text' name=\"MCTipsDetail"+(j+1)+"\" value=\""+jsonData[j].OptionDetails+"\" class=\"form-control\" /><div class=\"input-group-addon\">";
                                        options+="<label id=\""+(j+1)+"\" onclick='removeOptionII(this.id)' class=\"close\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></label></div></div></p></div>";
                                    }else{
                                    	options+="<div id=\"MCitems"+(j+1)+"\"><p><div class=\"input-group\"><div class=\"input-group-addon\"><input type='checkbox' value='False' name=\"MCoptions"+(j+1)+"\" id=\"MCoptions"+(j+1)+"\" />";
                                        options+="</div><input type='text' name=\"MCTipsDetail"+(j+1)+"\" value=\""+jsonData[j].OptionDetails+"\" class=\"form-control\" /><div class=\"input-group-addon\">";
                                        options+="<label id=\""+(j+1)+"\" onclick='removeOptionII(this.id)' class=\"close\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></label></div></div></p></div>";
                                    }
                                }			
                                h+="<label id='addMCoptions' name=\""+j+"\" onclick='addMCoptions(this.name)' class=\"btn btn-block btn-primary\">点此添加一个选项</label>"
                                $("#Coption").append(options);
                                $("#Choice").append(h);
                                $('input').iCheck({
            						checkboxClass: 'icheckbox_square-blue',
            						radioClass: 'iradio_square-blue',
            						increaseArea: '20%'
            					});
                            });
                        }else if(jsonData[qtype-1].TypeName=="判断题"){
                            $("#editForm").attr("action","../UpdateQuestion?qtid="+qid+"&questionid="+QuestionId+"&Qtype=TFChoice");
                            $.getJSON("../OptionJson?QuestionId="+QuestionId, function(jsonData) {
                                var options="";				 
                                for (var j = 0; j < jsonData.length; j++) {
                                    if(jsonData[j].IsCorrect=="True"){
                                        options+="<div id=\"items"+(j+1)+"\"><p><input type='radio' value='True'  name='TFoptions' id='TFoptions' checked=\"checked\" />正确</p></div>";
                                        options+="<div id=\"items"+(j+1)+"\"><p><input type='radio' value='False' name='TFoptions' id='TFoptions'/>错误</p></div>";
                                    }else{
                                        options+="<div id=\"items"+(j+1)+"\"><p><input type='radio' value='True'  name='TFoptions' id='TFoptions' />正确</p></div>";
                                        options+="<div id=\"items"+(j+1)+"\"><p><input type='radio' value='False' name='TFoptions' id='TFoptions'  checked=\"checked\"/>错误</p></div>";
                                    }
                                }								
                                $("#Coption").append(options);
                                $('input').iCheck({
                        			checkboxClass: 'icheckbox_square-blue',
                        			radioClass: 'iradio_square-blue',
                        			increaseArea: '20%'
                        		});
                            });
                        }else{
                            $("#editForm").attr("action","../UpdateQuestion?qtid="+qid+"&questionid="+QuestionId+"&Qtype=ShortAnswerQuestion");
                            $.getJSON("../OptionJson?QuestionId="+QuestionId, function(jsonData) {
                                var options="";				 
                                for (var j = 0; j < jsonData.length; j++) {
                                    options+="<div id=\"items"+(j+1)+"\"><p><textarea class=\"form-control\" rows='5' name='ShortAnswer' id='ShortAnswer'>"+jsonData[j].OptionDetails+"</textarea></p></div>";
                                }				
                                $("#Coption").append(options);
                                $('input').iCheck({
                        			checkboxClass: 'icheckbox_square-blue',
                        			radioClass: 'iradio_square-blue',
                        			increaseArea: '20%'
                        		});
                            });
                        }			
                    }				
                }<!--for 的 -->	
                $("#type").append(type);
            });
        });
        
        $("#subject").change(function() {
                    var SubjectId = $("#subject").val();
                    $("#tips").empty();
                    $("#tips").append("<option value=\"0\">请选择...</option>");
                    $.getJSON("../TipsJson?SubjectId="+ SubjectId,function(jsonData) {
                        var tips = "";
                        for (var i = 0; i < jsonData.length; i++) {
                            tips += "<option value=\""+jsonData[i].TipsId+"\">"+ jsonData[i].TipsName+ "</option>";
                        }
                        $("#tips").append(tips);
                    });
            });
    });
</script>
<script type="text/javascript">
	function myFunction() {
		$("input[name='SCoptions']").attr("value", "False");
		
		var Tnum=$("input[name='SCoptions']:checked").next().next().attr("id");
		$("input[name='SCoptions']:checked").attr("value", Tnum);
	};
	function removeOption(j){
		var name="items"+j;
		$("div[id="+name+"]").remove();
	};
	function removeOptionII(j){
		var name="MCitems"+j;
		$("div[id="+name+"]").remove();
	};
	function addOptions(j){
		var count = $("#addOptions").attr("name");
		var num = parseInt(count) + 1;
		var htm1 = "";
		$("#addOptions").attr("name",num.toString());
		htm1 += "<div id=\"items"+num+"\"><p><div class=\"input-group\"><div class=\"input-group-addon\"><input type=\"radio\" value=\"False\" name=\"SCoptions\" id=\"SCoptions\" onchange=\"myFunction()\"></div>";
		htm1 += "<input type=\"text\" name=\"SCTipsDetail"+num+"\" class=\"form-control\">";
		htm1+="<div class=\"input-group-addon\"><label name=\"SCRemove\" onclick=\"removeOption(this.id)\" id=\""+num+"\" class=\"close\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></label></div></div></p></div>";
		//form标签action属性传num的值
		$("#Coption").append(htm1);
		$('input').iCheck({
			checkboxClass: 'icheckbox_square-blue',
			radioClass: 'iradio_square-blue',
			increaseArea: '20%'
		});
	};
	function addMCoptions(j){
		var count = $("#addMCoptions").attr("name");
		var num = parseInt(count) + 1;
		var htm1 = "";
		$("#addMCoptions").attr("name",num.toString());
		htm1 += "<div id=\"MCitems"+num+"\"><p><div class=\"input-group\"><div class=\"input-group-addon\"><input type=\"checkbox\" value=\"False\" name=\"MCoptions"+num+"\" id=\"MCoptions"+num+"\">";
		htm1 += "</div><input type=\"text\" name=\"MCTipsDetail"+num+"\" class=\"form-control\"><div class=\"input-group-addon\">";
		htm1+="<label onclick=\"removeOptionII(this.id)\" id=\""+num+"\" class=\"close\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></label></div></div></p></div>";
		//form标签action属性传num的值
		$("#Coption").append(htm1);
		$('input').iCheck({
			checkboxClass: 'icheckbox_square-blue',
			radioClass: 'iradio_square-blue',
			increaseArea: '20%'
		});
	};
</script>
</html>